{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/ecommerce-project/frontend/pages/admin/dashboard.jsx"],"sourcesContent":["// Archivo: pages/admin/dashboard.jsx\r\n// Panel de Administración (Ruta Protegida: /admin/dashboard).\r\n\"use client\"; // Necesario para usar hooks de estado y useRouter\r\n\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport { useAuth } from '../../context/AuthContext'; // Manteniendo la ruta relativa para coincidir con la estructura\r\nimport { useRouter } from 'next/router'; // Manteniendo 'next/router' para la convención pages/\r\n\r\n// Definición de URL API (debe ser accesible desde el navegador)\r\nconst API_BASE_URL = 'http://localhost:3001/api';\r\n\r\n\r\n// --- COMPONENTE: Barra de Estadísticas (StatBar) ---\r\n// En una estructura modular, esto estaría en components/Admin/StatBar.jsx\r\nconst StatBarComponent = ({ item, maxSales }) => {\r\n    const percentage = ((item.sales / maxSales) * 100).toFixed(0);\r\n    return (\r\n        <div className=\"flex items-center space-x-4\">\r\n            <span className=\"w-1/4 font-medium text-gray-700 truncate\">{item.product}</span>\r\n            <div className=\"flex-grow bg-gray-200 rounded-full h-3\">\r\n                <div \r\n                    className=\"bg-indigo-500 h-3 rounded-full transition-all duration-500 ease-out\" \r\n                    style={{ width: `${percentage}%` }}\r\n                ></div>\r\n            </div>\r\n            <span className=\"w-12 text-right font-bold text-indigo-700\">{item.sales}</span>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n// --- PÁGINA: Admin Dashboard ---\r\nconst AdminDashboardPage = () => {\r\n    // Nota: API_BASE_URL no se necesita desestructurar de useAuth si se define globalmente\r\n    const { isAdmin, authToken, isCheckingAuth } = useAuth(); \r\n    const router = useRouter();\r\n    \r\n    const [products, setProducts] = useState([]);\r\n    const [stats, setStats] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Redirección de seguridad\r\n    useEffect(() => {\r\n        // Si la verificación terminó (no es null) Y no es admin, redirige al login\r\n        if (!isCheckingAuth && !isAdmin) { \r\n            router.replace('/login');\r\n        }\r\n    }, [isCheckingAuth, isAdmin, router]);\r\n\r\n    // Función para obtener productos y estadísticas\r\n    const fetchAdminData = useCallback(async () => {\r\n        setLoading(true);\r\n        if (!authToken) return;\r\n\r\n        try {\r\n            // 1. Fetch Estadísticas (Requiere Auth Token)\r\n            const statsResponse = await fetch(`${API_BASE_URL}/estadisticas/top-productos`, {\r\n                headers: { 'Authorization': `Bearer ${authToken}` }\r\n            });\r\n            const statsResult = await statsResponse.json();\r\n            \r\n            if (statsResponse.ok) {\r\n                setStats(statsResult.data);\r\n            } else {\r\n                console.error(`Error al cargar estadísticas: ${statsResult.message}`);\r\n            }\r\n\r\n            // 2. Fetch Productos (Ruta pública)\r\n            // Incluir el token por si el backend se endurece con seguridad.\r\n            const productsResponse = await fetch(`${API_BASE_URL}/productos`, {\r\n                 headers: { 'Authorization': `Bearer ${authToken}` } \r\n            }); \r\n            const productsResult = await productsResponse.json();\r\n\r\n             if (productsResponse.ok) {\r\n                setProducts(productsResult.data);\r\n            } else {\r\n                console.error(`Error al cargar productos: ${productsResult.message}`);\r\n            }\r\n\r\n\r\n        } catch (error) {\r\n            console.error('Error fetching admin data:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [authToken]);\r\n\r\n    useEffect(() => {\r\n        // Solo intenta cargar datos si es admin Y tiene token\r\n        if (isAdmin && authToken) {\r\n            fetchAdminData();\r\n        }\r\n    }, [isAdmin, authToken, fetchAdminData]);\r\n\r\n    if (isCheckingAuth || !isAdmin) {\r\n        // Muestra loading mientras verifica\r\n        return <div className=\"p-8 text-center text-indigo-600 min-h-screen\">Verificando acceso al Dashboard...</div>;\r\n    }\r\n\r\n    if (loading) {\r\n        return <div className=\"p-8 text-center text-indigo-600\">Cargando datos del Administrador...</div>;\r\n    }\r\n\r\n    // El Dashboard solo se renderiza si isAdmin es true\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 p-4 md:p-8\">\r\n            <div className=\"flex justify-between items-center mb-6 border-b pb-4\">\r\n                <h1 className=\"text-3xl font-extrabold text-indigo-700\">Panel de Administración Avanzado</h1>\r\n                <span className=\"bg-red-100 text-red-800 text-sm font-medium px-4 py-1.5 rounded-full\">ROL: ADMIN</span>\r\n            </div>\r\n\r\n            {/* Sección de Estadísticas (Gráficos) */}\r\n            <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Gráficos de Ventas Mensuales</h2>\r\n            <div className=\"bg-white p-6 rounded-xl shadow-lg mb-8\">\r\n                <p className=\"text-lg font-semibold mb-3\">Top Productos por Ventas (Noviembre)</p>\r\n                <div className=\"space-y-3\">\r\n                    {stats.length > 0 ? stats.map((item, index) => (\r\n                        <StatBarComponent \r\n                            key={index} \r\n                            item={item} \r\n                            maxSales={stats[0]?.sales || 1} \r\n                        />\r\n                    )) : (\r\n                        <p className=\"text-gray-500\">No hay datos de ventas disponibles.</p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Sección de Productos Registrados */}\r\n            <h2 className=\"text-2xl font-bold text-gray-800 mb-4\">Inventario y Productos Registrados</h2>\r\n            <div className=\"bg-white rounded-xl shadow-lg overflow-hidden\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-100\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">ID</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Nombre</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Precio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Stock</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Barcode</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {products.length > 0 ? products.map((product) => (\r\n                            <tr key={product.id}>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{product.id}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{product.nombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-indigo-600\">${product.precio.toFixed(2)}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600\">{product.stock}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{product.barcode}</td>\r\n                            </tr>\r\n                        )) : (\r\n                            <tr>\r\n                                <td colSpan=\"5\" className=\"px-6 py-4 text-center text-gray-500\">\r\n                                    No hay productos registrados.\r\n                                </td>\r\n                            </tr>\r\n                        )}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AdminDashboardPage;"],"names":[],"mappings":"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"}}]
}